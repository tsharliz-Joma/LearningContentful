import d, { useCallback, useState, useEffect } from 'react';
import { isValid, startOfDay, endOfDay, parse, format } from 'date-fns';
import { css, cx } from 'emotion';
import n from '@contentful/f36-tokens';
import { DayPicker, useDayPicker, CaptionDropdowns, CaptionNavigation } from 'react-day-picker';
export { Day, DayContent, useDayPicker } from 'react-day-picker';
import { Flex } from '@contentful/f36-core';
import { Heading } from '@contentful/f36-typography';
import { Popover } from '@contentful/f36-popover';
import ue from 'react-focus-lock';
import { TextInput } from '@contentful/f36-forms';
import { IconButton } from '@contentful/f36-button';
import { CalendarIcon } from '@contentful/f36-icons';

var J=Object.defineProperty,K=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var M=(e,t,o)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,p=(e,t)=>{for(var o in t||(t={}))z.call(t,o)&&M(e,o,t[o]);if(x)for(var o of x(t))W.call(t,o)&&M(e,o,t[o]);return e},P=(e,t)=>K(e,Q(t));var S=(e,t)=>{var o={};for(var i in e)z.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(e!=null&&x)for(var i of x(e))t.indexOf(i)<0&&W.call(e,i)&&(o[i]=e[i]);return o};var F=()=>({calendar:css({padding:n.spacingM})});var H=40,g=()=>({vhidden:css({boxSizing:"border-box",padding:"0",margin:"0",background:"transparent",border:"0",MozAppearance:"none",WebkitAppearance:"none",appearance:"none",position:"absolute",top:"0",width:"1px",height:"1px",overflow:"hidden",clip:"rect(1px, 1px, 1px, 1px)"}),button_reset:css({appearance:"none",position:"relative",margin:0,padding:0,border:"none",outline:"none",background:"none"}),button:css({borderRadius:"50%",cursor:"pointer",color:n.gray900,"&.rdp-day_disabled":{color:n.gray400,pointerEvents:"none"},"&:focus, &:active":{boxShadow:n.glowPrimary},"&:focus:not(:focus-visible)":{boxShadow:"unset"},"&:hover":{backgroundColor:n.gray200},"&.rdp-day_selected:not(.rdp-day_disabled)":{backgroundColor:n.blue600,color:n.colorWhite,fontWeight:n.fontWeightDemiBold}}),months:css({display:"flex"}),month:css({width:"100%",margin:"0 1em","&:first-child":{marginLeft:0},"&:last-child":{marginRight:0}}),table:css({width:"100%",margin:0,borderCollapse:"collapse"}),caption:css({position:"relative",padding:0,textAlign:"left",".rdp-multiple_months &":{display:"block",textAlign:"center"}}),caption_dropdowns:css({position:"relative",display:"inline-flex"}),caption_label:css({position:"relative",zIndex:1,display:"inline-flex",alignItems:"center",margin:"0",padding:`0 ${n.spacingXs}`,height:"2rem",whiteSpace:"nowrap",fontSize:n.fontSizeM,fontWeight:n.fontWeightMedium,borderRadius:n.borderRadiusMedium,"& + &":{marginLeft:"3px"}}),nav:css({whiteSpace:"nowrap",".rdp-multiple_months .rdp-caption_start &":{position:"absolute",top:"50%",left:"0",transform:"translateY(-50%)"},".rdp-multiple_months .rdp-caption_end &":{position:"absolute",top:"50%",right:"0",transform:"translateY(-50%)"}}),nav_button:css({width:"2rem",height:"2rem",display:"inline-flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent"}),nav_button_previous:css({marginRight:"3px"}),dropdown_month:css({position:"relative",display:"inline-flex",alignItems:"center"}),dropdown_year:css({position:"relative",display:"inline-flex",alignItems:"center"}),dropdown:css({appearance:"none",position:"absolute",zIndex:2,top:"0",bottom:"0",left:"0",width:"100%",margin:"0",padding:"0",cursor:"pointer",opacity:"0",border:"none",backgroundColor:"transparent",fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit","&:focus:not([disabled]) + div, &:active:not([disabled]) + div":{boxShadow:n.glowPrimary},"&:hover:not([disabled]) + div, &:hover:not([disabled]) + div":{backgroundColor:n.gray200}}),dropdown_icon:css({marginLeft:"8px"}),head:css({border:0}),head_row:css({height:"100%"}),row:css({height:"100%"}),head_cell:css({verticalAlign:"middle",fontSize:n.fontSizeS,fontWeight:n.fontWeightDemiBold,textAlign:"center",height:"32px",color:n.gray600}),tbody:css({border:0}),tfoot:css({margin:"0.5em"}),cell:css({padding:"2px",textAlign:"center"}),day:css({display:"flex",overflow:"hidden",alignItems:"center",justifyContent:"center",width:`${H/16}rem`,height:`${H/16}rem`,borderRadius:"50%",margin:"auto","&.rdp-day_today:not(.rdp-day_outside)":{fontWeight:n.fontWeightDemiBold},"&.rdp-day_today:not(.rdp-day_outside):not(.rdp-day_selected):not(:hover)":{backgroundColor:n.blue100}}),nav_icon:css({width:"0.625rem"})});var A=e=>{let t=g(),{fromDate:o,toDate:i,numberOfMonths:c}=useDayPicker(),s=Boolean(o&&i&&c===1);return d.createElement(Flex,{alignItems:"center",justifyContent:"space-between",className:t.caption},s&&d.createElement(CaptionDropdowns,p({},e)),d.createElement(CaptionNavigation,p({},e)))};var E=e=>{let t=g(),{fromDate:o,toDate:i,formatters:{formatCaption:c},locale:s,numberOfMonths:u}=useDayPicker(),l=Boolean(o&&i&&u===1);return d.createElement(Heading,{as:"h2","aria-live":"polite","aria-atomic":"true",id:e.id,className:cx(t.caption_label,l&&t.vhidden)},c(e.displayMonth,{locale:s}))};function V(e){var o;let t=g();return d.createElement(DayPicker,P(p({},e),{weekStartsOn:(o=e.weekStartsOn)!=null?o:1,classNames:t,components:p({Caption:A,CaptionLabel:E},e.components)}))}function be(e){let t=F(),L=e,{testId:o="cf-ui-datepicker",className:i,style:c,inputProps:s,popoverProps:u,selected:l,onSelect:m,fromDate:f,toDate:b,locale:k,dateFormat:y="dd LLL yyyy",defaultIsOpen:j}=L,$=S(L,["testId","className","style","inputProps","popoverProps","selected","onSelect","fromDate","toDate","locale","dateFormat","defaultIsOpen"]),h=useCallback(a=>!(!isValid(a)||f&&startOfDay(f).getTime()>a.getTime()||b&&a.getTime()>endOfDay(b).getTime()),[f,b]),D=useCallback(a=>parse(a,y,new Date,{locale:k}),[k,y]),[G,w]=useState(j),[v,I]=useState(()=>l?format(l,y):"");useEffect(()=>{if(!l){I("");return}l.getTime()!==D(v).getTime()&&I(format(l,y));},[l]);let U=useCallback(a=>{I(a.currentTarget.value);let O=D(a.currentTarget.value);h(O)?m(O):m(void 0);},[m,D,h]),X=useCallback(a=>{a&&h(a)&&(m(a),w(!1));},[m,h]),q=v&&!h(D(v));return d.createElement(Popover,p({isOpen:G,onClose:()=>w(!1)},u),d.createElement(Popover.Trigger,null,d.createElement(De,{className:i,style:c,testId:o,isDisabled:s==null?void 0:s.isDisabled,onTriggerClick:()=>{w(a=>!a);}},d.createElement(TextInput,p({placeholder:format(new Date,y),value:v,onChange:U,isInvalid:(s==null?void 0:s.isInvalid)||q,"aria-label":"Enter date",testId:"cf-ui-datepicker-input"},s)))),d.createElement(Popover.Content,null,d.createElement(ue,{returnFocus:!0},d.createElement(V,P(p({},$),{className:t.calendar,mode:"single",selected:l,onSelect:X,initialFocus:!1,defaultMonth:l,fromDate:f,toDate:b,locale:k})))))}var De=d.forwardRef((e,t)=>{let f=e,{children:o,testId:i,style:c,className:s,onTriggerClick:u,isDisabled:l}=f,m=S(f,["children","testId","style","className","onTriggerClick","isDisabled"]);return d.createElement(TextInput.Group,{ref:t,className:s,style:c,testId:i},o,d.createElement(IconButton,p({"aria-label":"Use calendar",variant:"secondary",icon:d.createElement(CalendarIcon,{"aria-label":"calendar"}),onClick:u,isDisabled:l,testId:"cf-ui-datepicker-button"},m)))});

export { V as Calendar, be as Datepicker };
//# sourceMappingURL=index.js.map