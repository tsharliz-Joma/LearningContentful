'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var e = require('react');
var f36Forms = require('@contentful/f36-forms');
var f36Typography = require('@contentful/f36-typography');
var emotion = require('emotion');
var r = require('@contentful/f36-tokens');
var f36Utils = require('@contentful/f36-utils');
var f36Core = require('@contentful/f36-core');
var f36Button = require('@contentful/f36-button');
var f36Icons = require('@contentful/f36-icons');
var f36Skeleton = require('@contentful/f36-skeleton');
var f36Popover = require('@contentful/f36-popover');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var e__default = /*#__PURE__*/_interopDefaultLegacy(e);
var r__default = /*#__PURE__*/_interopDefaultLegacy(r);

var ce=Object.defineProperty,pe=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var F=(t,l,o)=>l in t?ce(t,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[l]=o,h=(t,l)=>{for(var o in l||(l={}))W.call(l,o)&&F(t,o,l[o]);if(C)for(var o of C(l))j.call(l,o)&&F(t,o,l[o]);return t},U=(t,l)=>pe(t,ue(l));var P=(t,l)=>{var o={};for(var n in t)W.call(t,n)&&l.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&C)for(var n of C(t))l.indexOf(n)<0&&j.call(t,n)&&(o[n]=t[n]);return o};var M=()=>({multiselect:emotion.css({position:"relative",width:"100%"}),triggerButton:emotion.css({justifyContent:"space-between"}),currentSelection:emotion.css({width:"50%",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",verticalAlign:"bottom",marginRight:r__default["default"].spacing2Xs}),currentSelectionAddition:emotion.css({color:r__default["default"].gray600}),inputField:emotion.css({paddingRight:r__default["default"].spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap",border:"none",borderRadius:"0px",borderBottom:`1px solid ${r__default["default"].gray200}`}),toggleButton:emotion.css({position:"absolute",top:"1px",right:"1px",zIndex:r__default["default"].zIndexDefault,padding:r__default["default"].spacing2Xs,height:r__default["default"].spacingXl}),content:t=>emotion.css({overflow:"auto",maxHeight:`${t}px`}),list:emotion.css({listStyle:"none",padding:`${r__default["default"].spacingXs} 0`,margin:0}),groupTitle:emotion.css({padding:`${r__default["default"].spacingXs} ${r__default["default"].spacingM}`,lineHeight:r__default["default"].lineHeightM}),noMatchesTitle:emotion.css({color:r__default["default"].gray500,margin:r__default["default"].spacingM}),selectAll:emotion.css({"label > *":{fontWeight:"bold"}}),item:emotion.css({label:{padding:`${r__default["default"].spacingXs} ${r__default["default"].spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",hyphens:"auto",display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer","&:focus, &:hover":{backgroundColor:r__default["default"].gray100},"&:active":{backgroundColor:r__default["default"].gray200},"&:focus":{boxShadow:r__default["default"].glowPrimary},"&:focus:not(:focus-visible)":{boxShadow:"unset"},"&:focus-visible":{boxShadow:r__default["default"].glowPrimary}}}),disabled:emotion.css({opacity:.5,cursor:"not-allowed"})});var d=H=>{var x=H,{label:t,value:l,itemId:o,onSelectItem:n,searchValue:p,isChecked:u=!1,isDisabled:c=!1,className:S}=x,v=P(x,["label","value","itemId","onSelectItem","searchValue","isChecked","isDisabled","className"]);let y=M();return e__default["default"].createElement("li",h({className:S},v),e__default["default"].createElement(f36Forms.Checkbox,{id:o,value:l,onChange:b=>n(b),isChecked:u,isDisabled:c,className:emotion.cx(y.item,c&&y.disabled)},e__default["default"].createElement(f36Typography.Text,{"data-test-id":`cf-multiselect-list-item-${o}`},e__default["default"].createElement(_,{item:t,inputValue:p}))))};function _({item:t,inputValue:l=""}){let{before:o,match:n,after:p}=f36Utils.getStringMatch(t,l);return e__default["default"].createElement(e__default["default"].Fragment,null,o,e__default["default"].createElement("b",{"data-test-id":"cf-multiselect-item-match"},n),p)}_.displayName="HighlightedItem";var Q=(t,l,o)=>e__default["default"].Children.map(t,n=>{if(!e__default["default"].isValidElement(n))return n;if(l(n))return o(n);let p=Q(n.props.children,l,o);return e__default["default"].cloneElement(n,{children:p})}),Y=(t,l)=>{let o=0;return e__default["default"].Children.forEach(t,n=>{!e__default["default"].isValidElement(n)||(l(n)?o+=1:o+=Y(n.props.children,l));}),o};function Pe(t,l){let{className:o,startIcon:n,placeholder:p="Select one or more Items",currentSelection:u=[],onSearchValueChange:c,searchPlaceholder:S="Search",searchInputRef:v,searchInputName:H,noMatchesMessage:x="No matches found",toggleRef:y,isLoading:b=!1,testId:ee="cf-multiselect",popoverProps:N={},children:I,onBlur:E}=t,{listMaxHeight:te=180,listRef:oe}=N,a=M(),[m,R]=e.useState(""),[B,V]=e.useState(!1),L=e.useRef(null),D=e.useRef(null),$=typeof c=="function",O=e.useCallback(()=>{var i;(i=D.current)==null||i.focus();},[]),le=e.useCallback(i=>{R(i.target.value),c==null||c(i);},[c,R]),ne=e.useCallback(()=>{if(!m)return;O(),Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(L.current,"");let f=new Event("change",{bubbles:!0});L.current.dispatchEvent(f);},[m,O]),re=e.useCallback(()=>{if(u.length===0)return e__default["default"].createElement(e__default["default"].Fragment,null,p);let i=u.length-1;return i===0?e__default["default"].createElement("span",{"data-test-id":"cf-multiselect-current-selection",className:a.currentSelection},u[0]):e__default["default"].createElement("span",{"data-test-id":"cf-multiselect-current-selection",className:a.currentSelection},u[0]," ",e__default["default"].createElement("span",{className:a.currentSelectionAddition},"and ",i," more"))},[u,p,a.currentSelection,a.currentSelectionAddition]),X=e.useMemo(()=>Y(I,i=>i.type===d),[I]),ie=e__default["default"].useCallback(i=>Q(i,f=>f.type===d,f=>{let se=ae=>{var z;O(),(z=f.props)==null||z.onSelectItem(ae);};return e__default["default"].cloneElement(f,{searchValue:m,onSelectItem:se})}),[m,O]);return e__default["default"].createElement("div",{"data-test-id":ee,className:emotion.cx(a.multiselect,o),ref:l},e__default["default"].createElement(f36Popover.Popover,U(h({renderOnlyWhenOpen:!1,isFullWidth:!0},N),{isOpen:B,onClose:()=>V(!1)}),e__default["default"].createElement(f36Popover.Popover.Trigger,null,e__default["default"].createElement(f36Button.Button,{"aria-label":"Toggle Multiselect",ref:y,onClick:()=>V(!B),startIcon:n,endIcon:e__default["default"].createElement(f36Icons.ChevronDownIcon,null),isFullWidth:!0,className:a.triggerButton},re())),e__default["default"].createElement(f36Popover.Popover.Content,{ref:f36Core.mergeRefs(oe,D),className:emotion.cx(a.content(te),N.className),testId:"cf-multiselect-container",onBlur:()=>E==null?void 0:E()},e__default["default"].createElement(e__default["default"].Fragment,null,$&&e__default["default"].createElement(e__default["default"].Fragment,null,e__default["default"].createElement(f36Forms.TextInput,{"aria-label":"Search",type:"text",value:m,className:a.inputField,testId:"cf-multiselect-search",placeholder:S,onChange:le,ref:f36Core.mergeRefs(v,L),name:H,size:"small"}),e__default["default"].createElement(f36Button.IconButton,{"aria-label":m?"Clear search":"Search",className:a.toggleButton,variant:"transparent",icon:m?e__default["default"].createElement(f36Icons.CloseIcon,{variant:"muted"}):e__default["default"].createElement(f36Icons.SearchIcon,{variant:"muted"}),onClick:ne,isDisabled:!m,size:"small"})),b&&e__default["default"].createElement(we,null),!b&&X>0&&e__default["default"].createElement("ul",{className:a.list,"data-test-id":"cf-multiselect-items"},$?ie(I):I),!b&&X===0&&e__default["default"].createElement(f36Typography.Subheading,{className:a.noMatchesTitle},x)))))}var we=()=>e__default["default"].createElement(f36Skeleton.SkeletonContainer,{svgHeight:16},e__default["default"].createElement(f36Skeleton.SkeletonBodyText,{numberOfLines:1})),Z=e__default["default"].forwardRef(Pe);var k=u=>{var c=u,{label:t,onSelectItem:l,isChecked:o=!1,className:n}=c,p=P(c,["label","onSelectItem","isChecked","className"]);let S=M();return e__default["default"].createElement(d,h({value:"all",label:t||o?"Deselect all":"Select all",itemId:"SelectAll",onSelectItem:l,isChecked:o,className:emotion.cx(S.selectAll,n)},p))};var A=Z;A.Option=d;A.SelectAll=k;

exports.Multiselect = A;
exports.MultiselectOption = d;
exports.SelectAllOption = k;
//# sourceMappingURL=index.js.map