import e, { useState, useRef, useCallback, useMemo } from 'react';
import { Checkbox, TextInput } from '@contentful/f36-forms';
import { Text, Subheading } from '@contentful/f36-typography';
import { cx, css } from 'emotion';
import r from '@contentful/f36-tokens';
import { getStringMatch } from '@contentful/f36-utils';
import { mergeRefs } from '@contentful/f36-core';
import { Button, IconButton } from '@contentful/f36-button';
import { ChevronDownIcon, CloseIcon, SearchIcon } from '@contentful/f36-icons';
import { SkeletonContainer, SkeletonBodyText } from '@contentful/f36-skeleton';
import { Popover } from '@contentful/f36-popover';

var ce=Object.defineProperty,pe=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var F=(t,l,o)=>l in t?ce(t,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[l]=o,h=(t,l)=>{for(var o in l||(l={}))W.call(l,o)&&F(t,o,l[o]);if(C)for(var o of C(l))j.call(l,o)&&F(t,o,l[o]);return t},U=(t,l)=>pe(t,ue(l));var P=(t,l)=>{var o={};for(var n in t)W.call(t,n)&&l.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&C)for(var n of C(t))l.indexOf(n)<0&&j.call(t,n)&&(o[n]=t[n]);return o};var M=()=>({multiselect:css({position:"relative",width:"100%"}),triggerButton:css({justifyContent:"space-between"}),currentSelection:css({width:"50%",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",verticalAlign:"bottom",marginRight:r.spacing2Xs}),currentSelectionAddition:css({color:r.gray600}),inputField:css({paddingRight:r.spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap",border:"none",borderRadius:"0px",borderBottom:`1px solid ${r.gray200}`}),toggleButton:css({position:"absolute",top:"1px",right:"1px",zIndex:r.zIndexDefault,padding:r.spacing2Xs,height:r.spacingXl}),content:t=>css({overflow:"auto",maxHeight:`${t}px`}),list:css({listStyle:"none",padding:`${r.spacingXs} 0`,margin:0}),groupTitle:css({padding:`${r.spacingXs} ${r.spacingM}`,lineHeight:r.lineHeightM}),noMatchesTitle:css({color:r.gray500,margin:r.spacingM}),selectAll:css({"label > *":{fontWeight:"bold"}}),item:css({label:{padding:`${r.spacingXs} ${r.spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",hyphens:"auto",display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer","&:focus, &:hover":{backgroundColor:r.gray100},"&:active":{backgroundColor:r.gray200},"&:focus":{boxShadow:r.glowPrimary},"&:focus:not(:focus-visible)":{boxShadow:"unset"},"&:focus-visible":{boxShadow:r.glowPrimary}}}),disabled:css({opacity:.5,cursor:"not-allowed"})});var d=H=>{var x=H,{label:t,value:l,itemId:o,onSelectItem:n,searchValue:p,isChecked:u=!1,isDisabled:c=!1,className:S}=x,v=P(x,["label","value","itemId","onSelectItem","searchValue","isChecked","isDisabled","className"]);let y=M();return e.createElement("li",h({className:S},v),e.createElement(Checkbox,{id:o,value:l,onChange:b=>n(b),isChecked:u,isDisabled:c,className:cx(y.item,c&&y.disabled)},e.createElement(Text,{"data-test-id":`cf-multiselect-list-item-${o}`},e.createElement(_,{item:t,inputValue:p}))))};function _({item:t,inputValue:l=""}){let{before:o,match:n,after:p}=getStringMatch(t,l);return e.createElement(e.Fragment,null,o,e.createElement("b",{"data-test-id":"cf-multiselect-item-match"},n),p)}_.displayName="HighlightedItem";var Q=(t,l,o)=>e.Children.map(t,n=>{if(!e.isValidElement(n))return n;if(l(n))return o(n);let p=Q(n.props.children,l,o);return e.cloneElement(n,{children:p})}),Y=(t,l)=>{let o=0;return e.Children.forEach(t,n=>{!e.isValidElement(n)||(l(n)?o+=1:o+=Y(n.props.children,l));}),o};function Pe(t,l){let{className:o,startIcon:n,placeholder:p="Select one or more Items",currentSelection:u=[],onSearchValueChange:c,searchPlaceholder:S="Search",searchInputRef:v,searchInputName:H,noMatchesMessage:x="No matches found",toggleRef:y,isLoading:b=!1,testId:ee="cf-multiselect",popoverProps:N={},children:I,onBlur:E}=t,{listMaxHeight:te=180,listRef:oe}=N,a=M(),[m,R]=useState(""),[B,V]=useState(!1),L=useRef(null),D=useRef(null),$=typeof c=="function",O=useCallback(()=>{var i;(i=D.current)==null||i.focus();},[]),le=useCallback(i=>{R(i.target.value),c==null||c(i);},[c,R]),ne=useCallback(()=>{if(!m)return;O(),Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(L.current,"");let f=new Event("change",{bubbles:!0});L.current.dispatchEvent(f);},[m,O]),re=useCallback(()=>{if(u.length===0)return e.createElement(e.Fragment,null,p);let i=u.length-1;return i===0?e.createElement("span",{"data-test-id":"cf-multiselect-current-selection",className:a.currentSelection},u[0]):e.createElement("span",{"data-test-id":"cf-multiselect-current-selection",className:a.currentSelection},u[0]," ",e.createElement("span",{className:a.currentSelectionAddition},"and ",i," more"))},[u,p,a.currentSelection,a.currentSelectionAddition]),X=useMemo(()=>Y(I,i=>i.type===d),[I]),ie=e.useCallback(i=>Q(i,f=>f.type===d,f=>{let se=ae=>{var z;O(),(z=f.props)==null||z.onSelectItem(ae);};return e.cloneElement(f,{searchValue:m,onSelectItem:se})}),[m,O]);return e.createElement("div",{"data-test-id":ee,className:cx(a.multiselect,o),ref:l},e.createElement(Popover,U(h({renderOnlyWhenOpen:!1,isFullWidth:!0},N),{isOpen:B,onClose:()=>V(!1)}),e.createElement(Popover.Trigger,null,e.createElement(Button,{"aria-label":"Toggle Multiselect",ref:y,onClick:()=>V(!B),startIcon:n,endIcon:e.createElement(ChevronDownIcon,null),isFullWidth:!0,className:a.triggerButton},re())),e.createElement(Popover.Content,{ref:mergeRefs(oe,D),className:cx(a.content(te),N.className),testId:"cf-multiselect-container",onBlur:()=>E==null?void 0:E()},e.createElement(e.Fragment,null,$&&e.createElement(e.Fragment,null,e.createElement(TextInput,{"aria-label":"Search",type:"text",value:m,className:a.inputField,testId:"cf-multiselect-search",placeholder:S,onChange:le,ref:mergeRefs(v,L),name:H,size:"small"}),e.createElement(IconButton,{"aria-label":m?"Clear search":"Search",className:a.toggleButton,variant:"transparent",icon:m?e.createElement(CloseIcon,{variant:"muted"}):e.createElement(SearchIcon,{variant:"muted"}),onClick:ne,isDisabled:!m,size:"small"})),b&&e.createElement(we,null),!b&&X>0&&e.createElement("ul",{className:a.list,"data-test-id":"cf-multiselect-items"},$?ie(I):I),!b&&X===0&&e.createElement(Subheading,{className:a.noMatchesTitle},x)))))}var we=()=>e.createElement(SkeletonContainer,{svgHeight:16},e.createElement(SkeletonBodyText,{numberOfLines:1})),Z=e.forwardRef(Pe);var k=u=>{var c=u,{label:t,onSelectItem:l,isChecked:o=!1,className:n}=c,p=P(c,["label","onSelectItem","isChecked","className"]);let S=M();return e.createElement(d,h({value:"all",label:t||o?"Deselect all":"Select all",itemId:"SelectAll",onSelectItem:l,isChecked:o,className:cx(S.selectAll,n)},p))};var A=Z;A.Option=d;A.SelectAll=k;

export { A as Multiselect, d as MultiselectOption, k as SelectAllOption };
//# sourceMappingURL=index.js.map