import i, { useState, useCallback } from 'react';
import { cx, css } from 'emotion';
import { useCombobox } from 'downshift';
import { mergeRefs } from '@contentful/f36-core';
import { IconButton } from '@contentful/f36-button';
import { TextInput } from '@contentful/f36-forms';
import { ChevronDownIcon, CloseIcon } from '@contentful/f36-icons';
import { Skeleton } from '@contentful/f36-skeleton';
import { Popover } from '@contentful/f36-popover';
import { Subheading, SectionHeading, Text } from '@contentful/f36-typography';
import { getStringMatch } from '@contentful/f36-utils';
import p from '@contentful/f36-tokens';

var xe=Object.defineProperty,ve=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var U=(e,o,n)=>o in e?xe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,c=(e,o)=>{for(var n in o||(o={}))W.call(o,n)&&U(e,n,o[n]);if(S)for(var n of S(o))q.call(o,n)&&U(e,n,o[n]);return e},d=(e,o)=>ve(e,Pe(o));var z=(e,o)=>{var n={};for(var r in e)W.call(e,r)&&o.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&S)for(var r of S(e))o.indexOf(r)<0&&q.call(e,r)&&(n[r]=e[r]);return n};var M=e=>({autocomplete:css({position:"relative",width:"100%"}),combobox:css({position:"relative"}),inputField:css({paddingRight:p.spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap"}),toggleButton:css({position:"absolute",top:"1px",right:"1px",zIndex:1,padding:p.spacing2Xs,height:"38px"}),content:css({overflow:"auto",maxHeight:`${e}px`}),list:css({listStyle:"none",padding:`${p.spacingXs} 0`,margin:0}),groupTitle:css({padding:`${p.spacingXs} ${p.spacingM}`,lineHeight:p.lineHeightM}),noMatchesTitle:css({color:p.gray500,margin:`${p.spacingM} 0 ${p.spacingM} 0`}),item:css({display:"block",padding:`${p.spacingXs} ${p.spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto","&:focus, &:hover":{backgroundColor:p.gray100},"&:active":{backgroundColor:p.gray200}}),disabled:css({opacity:.5,pointerEvents:"none"}),highlighted:css({backgroundColor:p.gray100}),hidden:css({display:"none"})});var C=e=>{let{items:o,elementStartIndex:n,highlightedIndex:r,getItemProps:I,renderItem:T,inputValue:b,listMaxHeight:H=180}=e,s=M(H);return i.createElement("ul",{className:s.list,"data-test-id":"cf-autocomplete-list"},o.map((u,k)=>{let g=n+k,w=I({item:u,index:g});return i.createElement(Text,d(c({},w),{as:"li",key:g,className:cx([s.item,r===g&&s.highlighted]),"data-test-id":`cf-autocomplete-list-item-${g}`}),T?T(u,b):typeof u=="string"?i.createElement(j,{item:u,inputValue:b}):u)}))};C.displayName="AutocompleteItems";function j({item:e,inputValue:o}){let{before:n,match:r,after:I}=getStringMatch(e,o);return i.createElement(i.Fragment,null,n,i.createElement("b",null,r),I)}j.displayName="HighlightedItem";function Ee(e,o){let {id:n,className:r,clearAfterSelect:I=!1,closeAfterSelect:T=!0,defaultValue:b="",selectedItem:H,items:s,onInputValueChange:u,onSelectItem:k,renderItem:g,icon:w=i.createElement(ChevronDownIcon,{variant:"muted"}),itemToString:Q=t=>t,isInvalid:Y,isDisabled:R,isRequired:Z,isReadOnly:ee,showEmptyList:te,noMatchesMessage:oe="No matches found",placeholder:ie="Search",inputRef:ne,toggleRef:se,listRef:re,listWidth:pe="auto",listMaxHeight:ae=180,isGrouped:x=!1,isLoading:v=!1,usePortal:le=!1,testId:me="cf-autocomplete"}=e,m=M(ae),[h,ue]=useState(b),y=useCallback(t=>{ue(t),u==null||u(t);},[u]),ce=useCallback(t=>{let a=t.target.value;y(a);},[y]),de=A(x)?s.reduce((t,a)=>[...t,...a.options],[]):s,ge=A(x)?s.every(t=>t.options.length===0):s.length===0,{getComboboxProps:he,getInputProps:fe,getItemProps:$,getMenuProps:Ie,getToggleButtonProps:ye,highlightedIndex:B,isOpen:D,toggleMenu:N}=useCombobox({items:de,selectedItem:H,inputValue:h,itemToString:Q,onInputValueChange:({type:t,inputValue:a})=>{t!=="__input_change__"&&y(a);},onStateChange:({type:t,selectedItem:a})=>{switch(t){case useCombobox.stateChangeTypes.InputKeyDownEnter:case useCombobox.stateChangeTypes.ItemClick:a&&k(a),I&&y(""),T||N();break;}}}),X=fe(),G=z(X,["aria-labelledby","id"]),Te=he(),F=ye(),P=Ie(),L=0;return i.createElement("div",{"data-test-id":me,className:cx(m.autocomplete,r),ref:o},i.createElement(Popover,{usePortal:le,isOpen:D,isFullWidth:pe==="full",renderOnlyWhenOpen:!1,autoFocus:!1,id:P.id},i.createElement(Popover.Trigger,null,i.createElement("div",d(c({},Te),{className:m.combobox}),i.createElement(TextInput,d(c({className:m.inputField},G),{onFocus:()=>{D||N();},id:n,isInvalid:Y,isDisabled:R,isRequired:Z,isReadOnly:ee,ref:mergeRefs(G.ref,ne),testId:"cf-autocomplete-input",placeholder:ie,onChange:t=>{G.onChange(t),ce(t);}})),i.createElement(IconButton,d(c({},F),{ref:mergeRefs(F.ref,se),"aria-label":h?"Clear":"Show list",className:m.toggleButton,variant:"transparent",icon:h?i.createElement(CloseIcon,{variant:"muted"}):w,onClick:()=>{h?y(""):N();},isDisabled:R,size:"small"})))),s.length>0||h.length>0||te?i.createElement(Popover.Content,d(c({},P),{ref:mergeRefs(P.ref,re),className:m.content,testId:"cf-autocomplete-container"}),v&&[...Array(3)].map((t,a)=>i.createElement("div",{key:a,className:cx(m.item,m.disabled)},i.createElement(Ve,null))),!v&&ge&&i.createElement("div",{className:m.item},i.createElement(Subheading,{className:m.noMatchesTitle},oe)),!v&&A(x)&&s.map((t,a)=>{if(t.options.length<1)return;let be=i.createElement("div",{key:a},i.createElement(SectionHeading,{key:a,"data-test-id":"cf-autocomplete-grouptitle",marginBottom:"none",className:m.groupTitle},t.groupTitle),i.createElement(C,{items:t.options,highlightedIndex:B,getItemProps:$,renderItem:g,inputValue:h,elementStartIndex:L}));return L+=t.options.length,be}),!v&&!A(x)&&s.length>0&&i.createElement(C,{items:s,elementStartIndex:L,highlightedIndex:B,getItemProps:$,renderItem:g,inputValue:h})):i.createElement("div",d(c({},P),{className:cx(m.hidden)}))))}var Ve=()=>i.createElement(Skeleton.Container,{svgHeight:16},i.createElement(Skeleton.BodyText,{numberOfLines:1}));function A(e,o){return e}var Oe=i.forwardRef(Ee);

export { Oe as Autocomplete };
//# sourceMappingURL=index.js.map