'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var i = require('react');
var emotion = require('emotion');
var downshift = require('downshift');
var f36Core = require('@contentful/f36-core');
var f36Button = require('@contentful/f36-button');
var f36Forms = require('@contentful/f36-forms');
var f36Icons = require('@contentful/f36-icons');
var f36Skeleton = require('@contentful/f36-skeleton');
var f36Popover = require('@contentful/f36-popover');
var f36Typography = require('@contentful/f36-typography');
var f36Utils = require('@contentful/f36-utils');
var p = require('@contentful/f36-tokens');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var i__default = /*#__PURE__*/_interopDefaultLegacy(i);
var p__default = /*#__PURE__*/_interopDefaultLegacy(p);

var xe=Object.defineProperty,ve=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var U=(e,o,n)=>o in e?xe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,c=(e,o)=>{for(var n in o||(o={}))W.call(o,n)&&U(e,n,o[n]);if(S)for(var n of S(o))q.call(o,n)&&U(e,n,o[n]);return e},d=(e,o)=>ve(e,Pe(o));var z=(e,o)=>{var n={};for(var r in e)W.call(e,r)&&o.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&S)for(var r of S(e))o.indexOf(r)<0&&q.call(e,r)&&(n[r]=e[r]);return n};var M=e=>({autocomplete:emotion.css({position:"relative",width:"100%"}),combobox:emotion.css({position:"relative"}),inputField:emotion.css({paddingRight:p__default["default"].spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap"}),toggleButton:emotion.css({position:"absolute",top:"1px",right:"1px",zIndex:1,padding:p__default["default"].spacing2Xs,height:"38px"}),content:emotion.css({overflow:"auto",maxHeight:`${e}px`}),list:emotion.css({listStyle:"none",padding:`${p__default["default"].spacingXs} 0`,margin:0}),groupTitle:emotion.css({padding:`${p__default["default"].spacingXs} ${p__default["default"].spacingM}`,lineHeight:p__default["default"].lineHeightM}),noMatchesTitle:emotion.css({color:p__default["default"].gray500,margin:`${p__default["default"].spacingM} 0 ${p__default["default"].spacingM} 0`}),item:emotion.css({display:"block",padding:`${p__default["default"].spacingXs} ${p__default["default"].spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto","&:focus, &:hover":{backgroundColor:p__default["default"].gray100},"&:active":{backgroundColor:p__default["default"].gray200}}),disabled:emotion.css({opacity:.5,pointerEvents:"none"}),highlighted:emotion.css({backgroundColor:p__default["default"].gray100}),hidden:emotion.css({display:"none"})});var C=e=>{let{items:o,elementStartIndex:n,highlightedIndex:r,getItemProps:I,renderItem:T,inputValue:b,listMaxHeight:H=180}=e,s=M(H);return i__default["default"].createElement("ul",{className:s.list,"data-test-id":"cf-autocomplete-list"},o.map((u,k)=>{let g=n+k,w=I({item:u,index:g});return i__default["default"].createElement(f36Typography.Text,d(c({},w),{as:"li",key:g,className:emotion.cx([s.item,r===g&&s.highlighted]),"data-test-id":`cf-autocomplete-list-item-${g}`}),T?T(u,b):typeof u=="string"?i__default["default"].createElement(j,{item:u,inputValue:b}):u)}))};C.displayName="AutocompleteItems";function j({item:e,inputValue:o}){let{before:n,match:r,after:I}=f36Utils.getStringMatch(e,o);return i__default["default"].createElement(i__default["default"].Fragment,null,n,i__default["default"].createElement("b",null,r),I)}j.displayName="HighlightedItem";function Ee(e,o){let {id:n,className:r,clearAfterSelect:I=!1,closeAfterSelect:T=!0,defaultValue:b="",selectedItem:H,items:s,onInputValueChange:u,onSelectItem:k,renderItem:g,icon:w=i__default["default"].createElement(f36Icons.ChevronDownIcon,{variant:"muted"}),itemToString:Q=t=>t,isInvalid:Y,isDisabled:R,isRequired:Z,isReadOnly:ee,showEmptyList:te,noMatchesMessage:oe="No matches found",placeholder:ie="Search",inputRef:ne,toggleRef:se,listRef:re,listWidth:pe="auto",listMaxHeight:ae=180,isGrouped:x=!1,isLoading:v=!1,usePortal:le=!1,testId:me="cf-autocomplete"}=e,m=M(ae),[h,ue]=i.useState(b),y=i.useCallback(t=>{ue(t),u==null||u(t);},[u]),ce=i.useCallback(t=>{let a=t.target.value;y(a);},[y]),de=A(x)?s.reduce((t,a)=>[...t,...a.options],[]):s,ge=A(x)?s.every(t=>t.options.length===0):s.length===0,{getComboboxProps:he,getInputProps:fe,getItemProps:$,getMenuProps:Ie,getToggleButtonProps:ye,highlightedIndex:B,isOpen:D,toggleMenu:N}=downshift.useCombobox({items:de,selectedItem:H,inputValue:h,itemToString:Q,onInputValueChange:({type:t,inputValue:a})=>{t!=="__input_change__"&&y(a);},onStateChange:({type:t,selectedItem:a})=>{switch(t){case downshift.useCombobox.stateChangeTypes.InputKeyDownEnter:case downshift.useCombobox.stateChangeTypes.ItemClick:a&&k(a),I&&y(""),T||N();break;}}}),X=fe(),G=z(X,["aria-labelledby","id"]),Te=he(),F=ye(),P=Ie(),L=0;return i__default["default"].createElement("div",{"data-test-id":me,className:emotion.cx(m.autocomplete,r),ref:o},i__default["default"].createElement(f36Popover.Popover,{usePortal:le,isOpen:D,isFullWidth:pe==="full",renderOnlyWhenOpen:!1,autoFocus:!1,id:P.id},i__default["default"].createElement(f36Popover.Popover.Trigger,null,i__default["default"].createElement("div",d(c({},Te),{className:m.combobox}),i__default["default"].createElement(f36Forms.TextInput,d(c({className:m.inputField},G),{onFocus:()=>{D||N();},id:n,isInvalid:Y,isDisabled:R,isRequired:Z,isReadOnly:ee,ref:f36Core.mergeRefs(G.ref,ne),testId:"cf-autocomplete-input",placeholder:ie,onChange:t=>{G.onChange(t),ce(t);}})),i__default["default"].createElement(f36Button.IconButton,d(c({},F),{ref:f36Core.mergeRefs(F.ref,se),"aria-label":h?"Clear":"Show list",className:m.toggleButton,variant:"transparent",icon:h?i__default["default"].createElement(f36Icons.CloseIcon,{variant:"muted"}):w,onClick:()=>{h?y(""):N();},isDisabled:R,size:"small"})))),s.length>0||h.length>0||te?i__default["default"].createElement(f36Popover.Popover.Content,d(c({},P),{ref:f36Core.mergeRefs(P.ref,re),className:m.content,testId:"cf-autocomplete-container"}),v&&[...Array(3)].map((t,a)=>i__default["default"].createElement("div",{key:a,className:emotion.cx(m.item,m.disabled)},i__default["default"].createElement(Ve,null))),!v&&ge&&i__default["default"].createElement("div",{className:m.item},i__default["default"].createElement(f36Typography.Subheading,{className:m.noMatchesTitle},oe)),!v&&A(x)&&s.map((t,a)=>{if(t.options.length<1)return;let be=i__default["default"].createElement("div",{key:a},i__default["default"].createElement(f36Typography.SectionHeading,{key:a,"data-test-id":"cf-autocomplete-grouptitle",marginBottom:"none",className:m.groupTitle},t.groupTitle),i__default["default"].createElement(C,{items:t.options,highlightedIndex:B,getItemProps:$,renderItem:g,inputValue:h,elementStartIndex:L}));return L+=t.options.length,be}),!v&&!A(x)&&s.length>0&&i__default["default"].createElement(C,{items:s,elementStartIndex:L,highlightedIndex:B,getItemProps:$,renderItem:g,inputValue:h})):i__default["default"].createElement("div",d(c({},P),{className:emotion.cx(m.hidden)}))))}var Ve=()=>i__default["default"].createElement(f36Skeleton.Skeleton.Container,{svgHeight:16},i__default["default"].createElement(f36Skeleton.Skeleton.BodyText,{numberOfLines:1}));function A(e,o){return e}var Oe=i__default["default"].forwardRef(Ee);

exports.Autocomplete = Oe;
//# sourceMappingURL=index.js.map