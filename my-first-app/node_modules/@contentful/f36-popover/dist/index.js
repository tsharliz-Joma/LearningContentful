'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var H = require('react');
var f36Core = require('@contentful/f36-core');
var reactPopper = require('react-popper');
var emotion = require('emotion');
var f36Utils = require('@contentful/f36-utils');
var x = require('@contentful/f36-tokens');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var H__default = /*#__PURE__*/_interopDefaultLegacy(H);
var x__default = /*#__PURE__*/_interopDefaultLegacy(x);

var oe=Object.defineProperty,te=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var B=(e,t,o)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,l=(e,t)=>{for(var o in t||(t={}))F.call(t,o)&&B(e,o,t[o]);if(b)for(var o of b(t))N.call(t,o)&&B(e,o,t[o]);return e},f=(e,t)=>te(e,re(t));var k=(e,t)=>{var o={};for(var r in e)F.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&b)for(var r of b(e))t.indexOf(r)<0&&N.call(e,r)&&(o[r]=e[r]);return o};var A=(e,t,o)=>new Promise((r,m)=>{var v=s=>{try{c(o.next(s));}catch(n){m(n);}},d=s=>{try{c(o.throw(s));}catch(n){m(n);}},c=s=>s.done?r(s.value):Promise.resolve(s.value).then(v,d);c((o=o.apply(e,t)).next());});var z=H__default["default"].createContext(void 0),y=()=>{let e=H__default["default"].useContext(z);if(e===void 0)throw new Error("usePopoverContext must be used within a PopoverContextProvider");return e},U=z.Provider;function G(e){let{children:t,isOpen:o,placement:r="bottom-start",isFullWidth:m=!1,isAutoalignmentEnabled:v=!0,usePortal:d=!0,closeOnBlur:c=!0,closeOnEsc:s=!0,onClose:n,autoFocus:h=!0,id:C,offset:T=[1,4],renderOnlyWhenOpen:g=!0}=e,[i,Q]=H.useState(null),[u,X]=H.useState(null),{attributes:W,update:M,styles:S}=reactPopper.usePopper(i,u,{placement:r,modifiers:[{name:"offset",options:{offset:T}},f(l({},ce),{enabled:m}),{name:"preventOverflow",enabled:v,options:{mainAxis:!0}},{name:"flip",enabled:v}]});H.useEffect(()=>{o&&h&&u&&u.focus({preventScroll:!0});},[o,u]),H.useEffect(()=>{(()=>A(this,null,function*(){o&&M&&(yield M());}))();},[o,M]);let Y=f36Core.useId(void 0,"popover-content"),E=C||Y,I=H.useCallback(()=>{n==null||n(),setTimeout(()=>i==null?void 0:i.focus({preventScroll:!0}),0);},[n,i]),w=H.useRef(!1),Z=H.useMemo(()=>({isOpen:Boolean(o),usePortal:d,renderOnlyWhenOpen:g,getTriggerProps:(p={},O=null)=>({onMouseDown:P=>{var a;w.current=!0,(a=p.onMouseDown)==null||a.call(p,P);},onMouseUp:P=>{var a;w.current=!1,(a=p.onMouseUp)==null||a.call(p,P);},ref:f36Core.mergeRefs(Q,O),["aria-expanded"]:Boolean(o),["aria-controls"]:E}),getPopoverProps:(p={},O=null)=>f(l({},W.popper),{style:l(l({},p.style||{}),S.popper),ref:f36Core.mergeRefs(X,O),id:E,onBlur:P=>{if(p.onBlur&&p.onBlur(P),!c)return;let a=P.relatedTarget,_=u===a||(u==null?void 0:u.contains(a)),ee=i===a||(i==null?void 0:i.contains(a))||w.current;_||ee||n==null||n();},onKeyDown:P=>{p.onKeyDown&&p.onKeyDown(P),s&&P.key==="Escape"&&I();}})}),[o,g,W,S,d,E,s,c,u,i,I,n]);return H__default["default"].createElement(U,{value:Z},t)}var ce={name:"sameWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:e})=>{e.styles.popper.width=`${e.rects.reference.width}px`;},effect:({state:e})=>()=>{let t=e.elements.reference;e.elements.popper.style.width=`${t.offsetWidth}px`;}};var V=e=>({container:emotion.css({display:e?"initial":"none",background:x__default["default"].colorWhite,border:0,borderRadius:x__default["default"].borderRadiusMedium,boxShadow:x__default["default"].boxShadowDefault,zIndex:x__default["default"].zIndexDropdown,"&:focus":{boxShadow:x__default["default"].glowPrimary,outline:"none"},"&:focus:not(:focus-visible)":{boxShadow:x__default["default"].boxShadowDefault}})});var fe=(e,t)=>{let g=e,{children:o,className:r,testId:m="cf-ui-popover-content",role:v="dialog"}=g,d=k(g,["children","className","testId","role"]),{isOpen:c,renderOnlyWhenOpen:s,getPopoverProps:n,usePortal:h}=y(),C=V(c),T=H__default["default"].createElement("div",f(l(l({},d),n(d,t)),{className:emotion.cx(C.container,r),"data-test-id":m,tabIndex:-1,role:v,"data-position-absolute":!0}),o);return s&&!c?null:h?H__default["default"].createElement(f36Utils.Portal,null,T):T},L=H__default["default"].forwardRef(fe);var R=e=>{var r;let t=H__default["default"].Children.only(e.children),{getTriggerProps:o}=y();return H__default["default"].cloneElement(t,f(l({},o(t.props,t.ref)),{"aria-haspopup":(r=t.props["aria-haspopup"])!=null?r:"dialog"}))};var D=G;D.Content=L;D.Trigger=R;

exports.Popover = D;
exports.PopoverContent = L;
exports.PopoverTrigger = R;
//# sourceMappingURL=index.js.map