'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var F = require('react');
var f36Core = require('@contentful/f36-core');
var f36Popover = require('@contentful/f36-popover');
var emotion = require('emotion');
var C = require('@contentful/f36-tokens');
var f36Typography = require('@contentful/f36-typography');
var f36Icons = require('@contentful/f36-icons');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var F__default = /*#__PURE__*/_interopDefaultLegacy(F);
var C__default = /*#__PURE__*/_interopDefaultLegacy(C);

var Fe=Object.defineProperty,De=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var ue=(e,t,o)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,u=(e,t)=>{for(var o in t||(t={}))me.call(t,o)&&ue(e,o,t[o]);if(A)for(var o of A(t))ae.call(t,o)&&ue(e,o,t[o]);return e},S=(e,t)=>De(e,Ae(t));var y=(e,t)=>{var o={};for(var n in e)me.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&A)for(var n of A(e))t.indexOf(n)<0&&ae.call(e,n)&&(o[n]=e[n]);return o};var ce={vertical:{prev:"ArrowUp",next:"ArrowDown"},horizontal:{prev:"ArrowLeft",next:"ArrowRight"}},pe=({itemsContainerRef:e,itemsSelector:t,keyType:o="vertical"})=>{let[n,i]=F.useState(0),m=F.useCallback(s=>{let d=e.current;if(!d)return;let x=d.querySelectorAll(t);if(x.length===0)return;let l=x.length-1,b=()=>i(0),g=()=>i(l),p=()=>{n===l?b():i(n+1);},T=()=>{n===0?g():i(n-1);},h={[ce[o].next]:p,[ce[o].prev]:T}[s.key];h&&(s.preventDefault(),h());},[n,t,e,o]);return {focusedIndex:n,handleArrowsKeyDown:m,setFocusedIndex:i}};var fe=F__default["default"].createContext(void 0),R=()=>{let e=F__default["default"].useContext(fe);if(e===void 0)throw new Error("useMenuContext must be used within a MenuContextProvider");return e},de=fe.Provider;var X='[role="menuitem"]:not(:disabled)';function W(e){let oe=e,{closeOnSelect:t=!0,closeOnBlur:o=!0,closeOnEsc:n=!0,children:i,onOpen:m}=oe,s=y(oe,["closeOnSelect","closeOnBlur","closeOnEsc","children","onOpen"]),{isOpen:d,handleOpen:x,handleClose:l,isControlled:b}=f36Core.useControllableState({isOpen:e.isOpen,defaultIsOpen:e.defaultIsOpen,onOpen:m,onClose:e.onClose}),g=F.useRef(null),p=F.useRef(null),T=f36Core.useId(null,"menu"),{focusedIndex:P,handleArrowsKeyDown:h,setFocusedIndex:a}=pe({itemsContainerRef:p,itemsSelector:X});F.useEffect(()=>{if(d&&p.current){let r=p.current.querySelectorAll(X);r.length>0&&P<r.length&&setTimeout(()=>{r[P].focus({preventScroll:!1});},0);}},[d,P]);let L=F.useCallback(r=>{let M=[...p.current.querySelectorAll(X)].findIndex(c=>r===c);M!==-1&&a(M);},[a]),f=F.useCallback(()=>{var r;l(),(r=g.current)==null||r.focus({preventScroll:!0});},[l]),E=F.useCallback(r=>{if(r.key==="Tab"){r.preventDefault(),f();return}if(r.stopPropagation(),r.key==="ArrowLeft"){r.preventDefault(),f();return}h(r);},[f,h]),U=F.useRef(!1),He=F.useMemo(()=>({isOpen:d,menuId:T,focusMenuItem:L,getTriggerProps:(r={},w=null)=>({onMouseDown:M=>{var c;U.current=!0,(c=r.onMouseDown)==null||c.call(r,M);},onMouseUp:M=>{var c;U.current=!1,(c=r.onMouseUp)==null||c.call(r,M);},onClick:M=>{var D;b&&!m||(d?l():x()),(D=r.onClick)==null||D.call(r,M);},ref:f36Core.mergeRefs(g,w)}),getMenuListProps:(r={},w=null)=>({ref:f36Core.mergeRefs(p,w),onKeyDown:M=>{var c;E(M),(c=r.onKeyDown)==null||c.call(r,M);},onBlur:M=>{var ne,re,se,ie;if((ne=r.onBlur)==null||ne.call(r,M),!o)return;let c=M.relatedTarget,D=p.current===c||((re=p.current)==null?void 0:re.contains(c)),Ne=g.current===c||((se=g.current)==null?void 0:se.contains(c))||U.current,ke=((ie=c==null?void 0:c.parentElement)==null?void 0:ie.dataset.parentMenu)===T;if(D||Ne||ke){M.stopPropagation();return}l();}}),getMenuItemProps:(r={})=>({onClick:w=>{var c;(c=r.onClick)==null||c.call(r,w);let M=Boolean(w.target.getAttribute("aria-haspopup"));t&&!M&&f();}}),propsToPropagateToSubmenus:{closeOnSelect:t,closeOnBlur:o,closeOnEsc:n}}),[T,d,E,t,l,x,L,o,n,f,b,m]);return F__default["default"].createElement(de,{value:He},F__default["default"].createElement(f36Popover.Popover,S(u({},s),{isOpen:d,onClose:l,id:T,closeOnEsc:n,autoFocus:!1,closeOnBlur:!1}),i))}var ye=F__default["default"].createContext(void 0),B=()=>F__default["default"].useContext(ye),xe=ye.Provider;var Te=()=>emotion.css({position:"sticky",top:0,left:0,backgroundColor:C__default["default"].colorWhite,borderBottom:`1px solid ${C__default["default"].gray300}`,padding:`${C__default["default"].spacingXs} 0`,zIndex:1001}),be=()=>emotion.css({position:"sticky",bottom:0,left:0,backgroundColor:C__default["default"].colorWhite,borderTop:`1px solid ${C__default["default"].gray300}`,padding:`${C__default["default"].spacingXs} 0`,zIndex:1001}),he=e=>({container:emotion.css({overflowY:"auto",position:"relative",padding:0,paddingTop:e.hasStickyHeader?0:C__default["default"].spacingXs,paddingBottom:e.hasStickyFooter?0:C__default["default"].spacingXs})});var O=e=>{let s=e,{children:t,testId:o="cf-ui-menu-list-header",className:n}=s,i=y(s,["children","testId","className"]),m=Te();return F__default["default"].createElement("div",u({"data-test-id":o,className:emotion.cx(m,n)},i),t)};O.displayName="MenuListHeader";var H=e=>{let s=e,{children:t,testId:o="cf-ui-menu-list-footer",className:n}=s,i=y(s,["children","testId","className"]),m=be();return F__default["default"].createElement("div",u({"data-test-id":o,className:emotion.cx(m,n)},i),t)};H.displayName="MenuListFooter";function Qe(e){var t;return Boolean((t=e==null?void 0:e.type)==null?void 0:t.displayName)}var Ze=(e,t)=>{let T=e,{children:o,testId:n="cf-ui-menu-list",className:i}=T,m=y(T,["children","testId","className"]),{getMenuListProps:s}=R(),d=B(),x=null,l=null,b=[];F__default["default"].Children.forEach(o,P=>{let h=!0;Qe(P)&&(P.type.displayName===O.displayName?(x=P,h=!1):P.type.displayName===H.displayName&&(l=P,h=!1)),h&&b.push(P);});let g=he({hasStickyHeader:Boolean(x),hasStickyFooter:Boolean(l)}),p=d?d.getSubmenuListProps(m):m;return F__default["default"].createElement(f36Popover.Popover.Content,S(u(u({role:"menu"},p),s(p,t)),{className:emotion.cx(g.container,i),testId:n}),x,b,l)},q=F__default["default"].forwardRef(Ze);var Se=()=>({root:emotion.css({display:"block",width:"100%",background:"none",border:0,margin:0,outline:"none",fontSize:C__default["default"].fontSizeM,lineHeight:C__default["default"].lineHeightM,fontWeight:C__default["default"].fontWeightNormal,position:"relative",textAlign:"left",padding:`${C__default["default"].spacingXs} ${C__default["default"].spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto",minWidth:"150px",textDecoration:"none",color:C__default["default"].gray800,"&:hover":{backgroundColor:C__default["default"].gray100},"&:focus":{boxShadow:`inset ${C__default["default"].glowPrimary}`,borderRadius:C__default["default"].borderRadiusMedium},"&:focus:not(:focus-visible)":{boxShadow:"unset",borderRadius:"unset"},"&:focus-visible":{boxShadow:`inset ${C__default["default"].glowPrimary}`,borderRadius:C__default["default"].borderRadiusMedium},"&:active":{backgroundColor:C__default["default"].gray200},"&:disabled":{opacity:.5,cursor:"auto"}})});var st="button";function Ee(e,t){let P=e,{testId:o,className:n,as:i,isInitiallyFocused:m}=P,s=y(P,["testId","className","as","isInitiallyFocused"]),d=f36Core.useId(void 0,"menu-item"),x=o||`cf-ui-${d}`,l=Se(),{getMenuItemProps:b,focusMenuItem:g}=R(),p=F.useRef(null);F.useEffect(()=>{m&&p.current&&g(p.current);},[m,g]);let T=i!=null?i:st;return F__default["default"].createElement(T,S(u(u({role:"menuitem"},s),b(s)),{className:emotion.cx(l.root,n),"data-test-id":x,ref:f36Core.mergeRefs(p,t),tabIndex:-1}),e.children)}Ee.displayName="MenuItem";var N=F__default["default"].forwardRef(Ee);var k=e=>{let t=F__default["default"].Children.only(e.children),{getTriggerProps:o}=R();return F__default["default"].createElement(f36Popover.Popover.Trigger,null,F__default["default"].cloneElement(t,S(u({},o(t.props,t.ref)),{["aria-haspopup"]:"menu"})))};var Le=()=>emotion.css({border:"none",width:"100%",height:"1px",background:C__default["default"].gray300,margin:`${C__default["default"].spacingXs} 0`});var j=e=>{let s=e,{children:t,testId:o="cf-ui-menu-divider",className:n}=s,i=y(s,["children","testId","className"]),m=Le();return F__default["default"].createElement("hr",u({"aria-orientation":"horizontal","data-test-id":o,className:emotion.cx(m,n)},i))};var Re=()=>emotion.css({textAlign:"left",padding:`${C__default["default"].spacingXs} ${C__default["default"].spacingM}`,lineHeight:C__default["default"].lineHeightM,"hr + &":{marginTop:"-8px"}});var J=e=>{let s=e,{children:t,testId:o="cf-ui-menu-section-title",className:n}=s,i=y(s,["children","testId","className"]),m=Re();return F__default["default"].createElement(f36Typography.SectionHeading,u({"aria-hidden":"true",testId:o,className:emotion.cx(m,n),marginBottom:"none"},i),t)};var yt=[-8,2],Z=e=>{let h=e,{onClose:t,onOpen:o}=h,n=y(h,["onClose","onOpen"]),{isOpen:i,menuId:m,propsToPropagateToSubmenus:s}=R(),d=F.useRef(null),x=F.useRef(null),[l,b]=F.useState(!1),g=F.useCallback(()=>{b(!0),window.clearTimeout(x.current),o==null||o();},[o]),p=F.useCallback(()=>{b(!1),window.clearTimeout(x.current),t==null||t();},[t]),T=F.useCallback(()=>{var a;p(),(a=d.current)==null||a.focus({preventScroll:!0});},[p]);F.useEffect(()=>{i===!1&&b(!1);},[i]);let P=F.useMemo(()=>({isOpen:l,getSubmenuListProps:a=>({"data-parent-menu":m,onMouseOver:L=>{var f;g(),(f=a.onMouseOver)==null||f.call(a,L);},onMouseLeave:L=>{var f;T(),(f=a.onMouseLeave)==null||f.call(a,L);}}),getSubmenuTriggerProps:(a,L)=>({ref:f36Core.mergeRefs(d,L),onKeyDown:f=>{var E;f.key==="ArrowRight"&&(f.preventDefault(),g()),(E=a.onKeyDown)==null||E.call(a,f);},onMouseOver:f=>{var E;g(),(E=a.onMouseOver)==null||E.call(a,f);},onMouseLeave:f=>{var E;x.current=window.setTimeout(T,300),(E=a.onMouseLeave)==null||E.call(a,f);}})}),[l,m,g,T]);return F__default["default"].createElement(xe,{value:P},F__default["default"].createElement(W,S(u(u({},s),n),{isOpen:l,onClose:p,onOpen:g,placement:"right-start",offset:yt,isAutoalignmentEnabled:!1})))};var Oe=()=>({root:({isActive:e})=>emotion.css(u({display:"flex",alignItems:"center",paddingRight:C__default["default"].spacingXs},e?{backgroundColor:C__default["default"].gray100}:{})),content:emotion.css({marginRight:C__default["default"].spacingM}),icon:emotion.css({marginLeft:"auto",fill:"currentColor"})});var bt=(e,t)=>{let{className:o,children:n}=e,{getSubmenuTriggerProps:i,isOpen:m}=B(),s=Oe();return F__default["default"].createElement(k,null,F__default["default"].createElement(N,S(u(u({},e),i(e,t)),{className:emotion.cx(s.root({isActive:m}),o)}),F__default["default"].createElement("span",{className:s.content},n),F__default["default"].createElement(f36Icons.ChevronRightIcon,{className:s.icon})))},te=F__default["default"].forwardRef(bt);var I=W;I.List=q;I.ListHeader=O;I.ListFooter=H;I.Item=N;I.Trigger=k;I.Divider=j;I.SectionTitle=J;I.Submenu=Z;I.SubmenuTrigger=te;

exports.Menu = I;
exports.MenuDivider = j;
exports.MenuItem = N;
exports.MenuList = q;
exports.MenuSectionTitle = J;
exports.MenuTrigger = k;
exports.Submenu = Z;
exports.SubmenuTrigger = te;
//# sourceMappingURL=index.js.map