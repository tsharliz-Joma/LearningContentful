import F, { useRef, useEffect, useState, useCallback, useMemo } from 'react';
import { useId, mergeRefs, useControllableState } from '@contentful/f36-core';
import { Popover } from '@contentful/f36-popover';
import { cx, css } from 'emotion';
import C from '@contentful/f36-tokens';
import { SectionHeading } from '@contentful/f36-typography';
import { ChevronRightIcon } from '@contentful/f36-icons';

var Fe=Object.defineProperty,De=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var ue=(e,t,o)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,u=(e,t)=>{for(var o in t||(t={}))me.call(t,o)&&ue(e,o,t[o]);if(A)for(var o of A(t))ae.call(t,o)&&ue(e,o,t[o]);return e},S=(e,t)=>De(e,Ae(t));var y=(e,t)=>{var o={};for(var n in e)me.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&A)for(var n of A(e))t.indexOf(n)<0&&ae.call(e,n)&&(o[n]=e[n]);return o};var ce={vertical:{prev:"ArrowUp",next:"ArrowDown"},horizontal:{prev:"ArrowLeft",next:"ArrowRight"}},pe=({itemsContainerRef:e,itemsSelector:t,keyType:o="vertical"})=>{let[n,i]=useState(0),m=useCallback(s=>{let d=e.current;if(!d)return;let x=d.querySelectorAll(t);if(x.length===0)return;let l=x.length-1,b=()=>i(0),g=()=>i(l),p=()=>{n===l?b():i(n+1);},T=()=>{n===0?g():i(n-1);},h={[ce[o].next]:p,[ce[o].prev]:T}[s.key];h&&(s.preventDefault(),h());},[n,t,e,o]);return {focusedIndex:n,handleArrowsKeyDown:m,setFocusedIndex:i}};var fe=F.createContext(void 0),R=()=>{let e=F.useContext(fe);if(e===void 0)throw new Error("useMenuContext must be used within a MenuContextProvider");return e},de=fe.Provider;var X='[role="menuitem"]:not(:disabled)';function W(e){let oe=e,{closeOnSelect:t=!0,closeOnBlur:o=!0,closeOnEsc:n=!0,children:i,onOpen:m}=oe,s=y(oe,["closeOnSelect","closeOnBlur","closeOnEsc","children","onOpen"]),{isOpen:d,handleOpen:x,handleClose:l,isControlled:b}=useControllableState({isOpen:e.isOpen,defaultIsOpen:e.defaultIsOpen,onOpen:m,onClose:e.onClose}),g=useRef(null),p=useRef(null),T=useId(null,"menu"),{focusedIndex:P,handleArrowsKeyDown:h,setFocusedIndex:a}=pe({itemsContainerRef:p,itemsSelector:X});useEffect(()=>{if(d&&p.current){let r=p.current.querySelectorAll(X);r.length>0&&P<r.length&&setTimeout(()=>{r[P].focus({preventScroll:!1});},0);}},[d,P]);let L=useCallback(r=>{let M=[...p.current.querySelectorAll(X)].findIndex(c=>r===c);M!==-1&&a(M);},[a]),f=useCallback(()=>{var r;l(),(r=g.current)==null||r.focus({preventScroll:!0});},[l]),E=useCallback(r=>{if(r.key==="Tab"){r.preventDefault(),f();return}if(r.stopPropagation(),r.key==="ArrowLeft"){r.preventDefault(),f();return}h(r);},[f,h]),U=useRef(!1),He=useMemo(()=>({isOpen:d,menuId:T,focusMenuItem:L,getTriggerProps:(r={},w=null)=>({onMouseDown:M=>{var c;U.current=!0,(c=r.onMouseDown)==null||c.call(r,M);},onMouseUp:M=>{var c;U.current=!1,(c=r.onMouseUp)==null||c.call(r,M);},onClick:M=>{var D;b&&!m||(d?l():x()),(D=r.onClick)==null||D.call(r,M);},ref:mergeRefs(g,w)}),getMenuListProps:(r={},w=null)=>({ref:mergeRefs(p,w),onKeyDown:M=>{var c;E(M),(c=r.onKeyDown)==null||c.call(r,M);},onBlur:M=>{var ne,re,se,ie;if((ne=r.onBlur)==null||ne.call(r,M),!o)return;let c=M.relatedTarget,D=p.current===c||((re=p.current)==null?void 0:re.contains(c)),Ne=g.current===c||((se=g.current)==null?void 0:se.contains(c))||U.current,ke=((ie=c==null?void 0:c.parentElement)==null?void 0:ie.dataset.parentMenu)===T;if(D||Ne||ke){M.stopPropagation();return}l();}}),getMenuItemProps:(r={})=>({onClick:w=>{var c;(c=r.onClick)==null||c.call(r,w);let M=Boolean(w.target.getAttribute("aria-haspopup"));t&&!M&&f();}}),propsToPropagateToSubmenus:{closeOnSelect:t,closeOnBlur:o,closeOnEsc:n}}),[T,d,E,t,l,x,L,o,n,f,b,m]);return F.createElement(de,{value:He},F.createElement(Popover,S(u({},s),{isOpen:d,onClose:l,id:T,closeOnEsc:n,autoFocus:!1,closeOnBlur:!1}),i))}var ye=F.createContext(void 0),B=()=>F.useContext(ye),xe=ye.Provider;var Te=()=>css({position:"sticky",top:0,left:0,backgroundColor:C.colorWhite,borderBottom:`1px solid ${C.gray300}`,padding:`${C.spacingXs} 0`,zIndex:1001}),be=()=>css({position:"sticky",bottom:0,left:0,backgroundColor:C.colorWhite,borderTop:`1px solid ${C.gray300}`,padding:`${C.spacingXs} 0`,zIndex:1001}),he=e=>({container:css({overflowY:"auto",position:"relative",padding:0,paddingTop:e.hasStickyHeader?0:C.spacingXs,paddingBottom:e.hasStickyFooter?0:C.spacingXs})});var O=e=>{let s=e,{children:t,testId:o="cf-ui-menu-list-header",className:n}=s,i=y(s,["children","testId","className"]),m=Te();return F.createElement("div",u({"data-test-id":o,className:cx(m,n)},i),t)};O.displayName="MenuListHeader";var H=e=>{let s=e,{children:t,testId:o="cf-ui-menu-list-footer",className:n}=s,i=y(s,["children","testId","className"]),m=be();return F.createElement("div",u({"data-test-id":o,className:cx(m,n)},i),t)};H.displayName="MenuListFooter";function Qe(e){var t;return Boolean((t=e==null?void 0:e.type)==null?void 0:t.displayName)}var Ze=(e,t)=>{let T=e,{children:o,testId:n="cf-ui-menu-list",className:i}=T,m=y(T,["children","testId","className"]),{getMenuListProps:s}=R(),d=B(),x=null,l=null,b=[];F.Children.forEach(o,P=>{let h=!0;Qe(P)&&(P.type.displayName===O.displayName?(x=P,h=!1):P.type.displayName===H.displayName&&(l=P,h=!1)),h&&b.push(P);});let g=he({hasStickyHeader:Boolean(x),hasStickyFooter:Boolean(l)}),p=d?d.getSubmenuListProps(m):m;return F.createElement(Popover.Content,S(u(u({role:"menu"},p),s(p,t)),{className:cx(g.container,i),testId:n}),x,b,l)},q=F.forwardRef(Ze);var Se=()=>({root:css({display:"block",width:"100%",background:"none",border:0,margin:0,outline:"none",fontSize:C.fontSizeM,lineHeight:C.lineHeightM,fontWeight:C.fontWeightNormal,position:"relative",textAlign:"left",padding:`${C.spacingXs} ${C.spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto",minWidth:"150px",textDecoration:"none",color:C.gray800,"&:hover":{backgroundColor:C.gray100},"&:focus":{boxShadow:`inset ${C.glowPrimary}`,borderRadius:C.borderRadiusMedium},"&:focus:not(:focus-visible)":{boxShadow:"unset",borderRadius:"unset"},"&:focus-visible":{boxShadow:`inset ${C.glowPrimary}`,borderRadius:C.borderRadiusMedium},"&:active":{backgroundColor:C.gray200},"&:disabled":{opacity:.5,cursor:"auto"}})});var st="button";function Ee(e,t){let P=e,{testId:o,className:n,as:i,isInitiallyFocused:m}=P,s=y(P,["testId","className","as","isInitiallyFocused"]),d=useId(void 0,"menu-item"),x=o||`cf-ui-${d}`,l=Se(),{getMenuItemProps:b,focusMenuItem:g}=R(),p=useRef(null);useEffect(()=>{m&&p.current&&g(p.current);},[m,g]);let T=i!=null?i:st;return F.createElement(T,S(u(u({role:"menuitem"},s),b(s)),{className:cx(l.root,n),"data-test-id":x,ref:mergeRefs(p,t),tabIndex:-1}),e.children)}Ee.displayName="MenuItem";var N=F.forwardRef(Ee);var k=e=>{let t=F.Children.only(e.children),{getTriggerProps:o}=R();return F.createElement(Popover.Trigger,null,F.cloneElement(t,S(u({},o(t.props,t.ref)),{["aria-haspopup"]:"menu"})))};var Le=()=>css({border:"none",width:"100%",height:"1px",background:C.gray300,margin:`${C.spacingXs} 0`});var j=e=>{let s=e,{children:t,testId:o="cf-ui-menu-divider",className:n}=s,i=y(s,["children","testId","className"]),m=Le();return F.createElement("hr",u({"aria-orientation":"horizontal","data-test-id":o,className:cx(m,n)},i))};var Re=()=>css({textAlign:"left",padding:`${C.spacingXs} ${C.spacingM}`,lineHeight:C.lineHeightM,"hr + &":{marginTop:"-8px"}});var J=e=>{let s=e,{children:t,testId:o="cf-ui-menu-section-title",className:n}=s,i=y(s,["children","testId","className"]),m=Re();return F.createElement(SectionHeading,u({"aria-hidden":"true",testId:o,className:cx(m,n),marginBottom:"none"},i),t)};var yt=[-8,2],Z=e=>{let h=e,{onClose:t,onOpen:o}=h,n=y(h,["onClose","onOpen"]),{isOpen:i,menuId:m,propsToPropagateToSubmenus:s}=R(),d=useRef(null),x=useRef(null),[l,b]=useState(!1),g=useCallback(()=>{b(!0),window.clearTimeout(x.current),o==null||o();},[o]),p=useCallback(()=>{b(!1),window.clearTimeout(x.current),t==null||t();},[t]),T=useCallback(()=>{var a;p(),(a=d.current)==null||a.focus({preventScroll:!0});},[p]);useEffect(()=>{i===!1&&b(!1);},[i]);let P=useMemo(()=>({isOpen:l,getSubmenuListProps:a=>({"data-parent-menu":m,onMouseOver:L=>{var f;g(),(f=a.onMouseOver)==null||f.call(a,L);},onMouseLeave:L=>{var f;T(),(f=a.onMouseLeave)==null||f.call(a,L);}}),getSubmenuTriggerProps:(a,L)=>({ref:mergeRefs(d,L),onKeyDown:f=>{var E;f.key==="ArrowRight"&&(f.preventDefault(),g()),(E=a.onKeyDown)==null||E.call(a,f);},onMouseOver:f=>{var E;g(),(E=a.onMouseOver)==null||E.call(a,f);},onMouseLeave:f=>{var E;x.current=window.setTimeout(T,300),(E=a.onMouseLeave)==null||E.call(a,f);}})}),[l,m,g,T]);return F.createElement(xe,{value:P},F.createElement(W,S(u(u({},s),n),{isOpen:l,onClose:p,onOpen:g,placement:"right-start",offset:yt,isAutoalignmentEnabled:!1})))};var Oe=()=>({root:({isActive:e})=>css(u({display:"flex",alignItems:"center",paddingRight:C.spacingXs},e?{backgroundColor:C.gray100}:{})),content:css({marginRight:C.spacingM}),icon:css({marginLeft:"auto",fill:"currentColor"})});var bt=(e,t)=>{let{className:o,children:n}=e,{getSubmenuTriggerProps:i,isOpen:m}=B(),s=Oe();return F.createElement(k,null,F.createElement(N,S(u(u({},e),i(e,t)),{className:cx(s.root({isActive:m}),o)}),F.createElement("span",{className:s.content},n),F.createElement(ChevronRightIcon,{className:s.icon})))},te=F.forwardRef(bt);var I=W;I.List=q;I.ListHeader=O;I.ListFooter=H;I.Item=N;I.Trigger=k;I.Divider=j;I.SectionTitle=J;I.Submenu=Z;I.SubmenuTrigger=te;

export { I as Menu, j as MenuDivider, N as MenuItem, q as MenuList, J as MenuSectionTitle, k as MenuTrigger, Z as Submenu, te as SubmenuTrigger };
//# sourceMappingURL=index.js.map